model Vehicle {
  /// @prismabox.input.hide
  id             String   @id @default(cuid())
  plate          String   @unique @db.Citext
  make           String
  model          String?
  photos         VehiclePhoto[]   @relation("vehiclePhotos")
  color          String
  year           Int?
  type           String?
  forSale        Boolean?
  /// @prismabox.input.hide
  submissionCount Int @default(0)
  /// @prismabox.input.hide
  confidence     Float @default(0)
  /// @prismabox.input.hide
  isActive       Boolean  @default(true)
  /// @prismabox.input.hide
  createdAt      DateTime @default(now())
  /// @prismabox.input.hide
  updatedAt      DateTime @updatedAt

  @@index([plate(sort:Asc)])
  @@index([make(sort:Asc)])
  @@index([createdAt(sort:Asc)])
  @@schema("vehicles")
  @@map("vehicles")
}

model VehicleSubmission {
  /// @prismabox.input.hide
  id             String   @id @default(cuid())
  plate          String
  make           String
  model          String?
  photos         VehiclePhoto[] @relation("vehicleSubmissionPhotos")

  color          String?
  year           Int?
  type           String?
  forSale        Boolean?
  /// @prismabox.input.hide
  submittedById    String
  submittedBy      User?    @relation(fields: [submittedById], references: [id])
  /// @prismabox.input.hide
  isActive       Boolean  @default(true)
  /// @prismabox.input.hide
  createdAt      DateTime @default(now())
  /// @prismabox.input.hide
  updatedAt      DateTime @updatedAt

  @@index([plate])
  @@index([make(sort:Asc)])
  @@index([createdAt(sort:Asc)])
  @@schema("vehicles")
  @@map("vehicle_submissions")
  @@unique([plate, submittedById]) // user can only submit once per plate
}

model VehiclePhoto {
  /// @prismabox.input.hide
  id             String   @id @default(cuid())
  url          String
  /// @prismabox.input.hide
  isPrimary      Boolean  @default(false)
  /// @prismabox.input.hide
  uploadSizeKb     Int?
  /// @prismabox.input.hide
  pHash          String?
  /// @prismabox.input.hide
  width          Int?
  /// @prismabox.input.hide
  height         Int?
  /// @prismabox.input.hide
  verifiedById   String?
  verifiedBy     User?    @relation("VehiclePhotoVerifiedBy",fields: [verifiedById], references: [id])
  verifiedAt     DateTime?
  /// @prismabox.input.hide
  submittedVehicleId      String
  submittedVehicle        VehicleSubmission @relation("vehicleSubmissionPhotos", fields: [submittedVehicleId], references: [id])

  vehicleId      String?
  vehicle        Vehicle? @relation("vehiclePhotos", fields: [vehicleId], references: [id], onDelete: Cascade)
  /// @prismabox.input.hide
  createdAt      DateTime @default(now())
  /// @prismabox.input.hide
  updatedAt      DateTime @updatedAt

  @@index([createdAt(sort:Desc)])
  @@index([submittedVehicleId(sort:Desc)])
  @@index([vehicleId(sort:Desc)])
  @@schema("vehicles")
  @@map("vehicle_photos")
}

enum VehicleType {
  offroad
  pickup
  truck
  motorbike
  quadbike
  semi
  trailer
  suv
  van
  bus
  sedan
  coupe
  limousine
  convertible
  hatchback

  @@schema("vehicles")
  @@map("vehicle_types")
}
